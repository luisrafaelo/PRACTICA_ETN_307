
#include <complex.h>
#include "polynom.h"
#include "vector.h"
#include "matrix.h"
typedef polynom<complex> cpolynom;
typedef vector<complex> cvector;
typedef matrix<complex> cmatrix;
cvector square(complex, complex, complex);
cvector kardano(double, double, double, double);
cvector ferrary(double, double, double, double,
double);
cvector newton(cpolynom);
#endif
69
#ifndef __EQUATION_H
#include "equation.h"
#endif
/*??????? ??????????? ????????? ? ???????????? ?????????????? */
cvector square(complex a2,complex a1,complex a0)
{
 complex a=a2,b=a1,c=a0;
/*????????? ??????????? ????? ?????? ???? ????????
? ???????????????? ??????????? ??????-????????? */
 cvector res(2);
 //????????, ?? ??????? ?? ??????????? ??? ?^2
 if(a!=complex(0,0))
 {
 /*???? ??, ???? ????? ????? ???????????? ????????????*/
 complex D=b*b-4*a*c;
 res[0]=(-b+sqrt(D))/(2*a);
 //? ??????? ?? ? ???????????????
 res[1]=(-b-sqrt(D))/(2*a);
 //?????????? ???????-??????????
 }
 else
 res[0]=res[1]=-c/b;/*????? ?????? ????????? 
?????? ???????*/
 return res;
}
/*??????? ??????????? ????????? ? ??????????????? 
?????????????? ??????? ???????-????????*/
cvector kardano(double a3, double a2, double a1,
double a0)
{
 /*????? ??? ?????????, ????? ???????? ?? ???? -
a3*x^3+a2*x^2+a1*x+a0=0. ??? ??? ????????? ????? 
?????? ???????, ?? ? ?????? ? ???? ???, ??? ? ?????????? ??????????? ???????-??????????*/
 cvector res=3;
 if(a3==0)//???? ??????????? ??? x^3 ???????,
 {
 //?????? ??????????????? ?????????? ?????????
 cvector res2=square(a2,a1,a0);
70
 /*? ???? ?????? ?????????, ??? ??? ????? ???????? ???????????? */
 res[0]=res[1]=res2[0];
 res[2]=res2[1];
 }
 else
 {
 /*????? - ???????? ?????????? ????????? ? ????????????? ????, ????? ??????????? ??? ??????? ??????? ????? 1 */
 double a=a2/a3,b=a1/a3,c=a0/a3;
 //??????? ????????? ??????????? ?????????????
 double p=b-a*a/3,q=2*a*a*a/27-a*b/3+c;
 /*??????? ??????????????? x=y-a/3, ?????? ? 
?????????? ????????? y^3+p*y+q=0 */
 //??????? ?????????? ????????????
 double diskr=pow(q/2,2)+pow(p/3,3);
 /*???? ???????????? ????? 0, ?? ????? 3 ?????????????? ?????, ?? ??? ??? ??????????? */
 if(diskr==0)
 {
 res[0]=3*q/p;
 res[1]=res[2]=-res[0]/2;
 }
 /*???? ?????????????? ?????? ? ??? ?????????? 
???????????*/
 if(diskr>0)
 {
 double what=-q/2+sqrt(diskr);
 double u0=(what>0)?pow(what,1.0/3.0):-pow(-
what, 1.0/3.0);
 double v0=-p/(3*u0);
 res[0]=u0+v0;
 res[1]=res[2]=-res[0]/2;
 complex k3(0,sqrt(3)*(u0-v0)/2);
 res[1]+=k3;
 res[2]-=k3;
 }
 //??? ????????? ?????????????? ?????
 if(diskr<0)
 {
 cvector zkub12=square(1,q,-p*p*p/27);
 complex u0=pow(zkub12[0],1/3.);
71
 res[0]=2*real(u0);
 res[1]=-real(u0)-imag(u0)*sqrt(3);
 res[2]=-real(u0)+imag(u0)*sqrt(3);
 }
 //????????? ??????? ?? ? ? ?
 for(int i=0;i<3;i++)
 res[i]-=a/3;
 }
 return res;//?????????? ??????-?????????
}
/*????? ??????? ??? ??????? ????????? ????????? 
??????? ? ??????????????? ??????????????*/
cvector ferrary(double a4, double a3, double a2,
double a1, double a0)
{
 cvector res=4;//????? ?????? ????? 4
 if(!a4)/*???? ??????????? ??? ????????? ??????? ? 
???????, ???????? ?????? ????????? ??????? ???????*/
 {
 cvector res3=kardano(a3,a2,a1,a0);
 res[0]=res[1]=res3[0];
 for(int i=1;i<3;i++)
 res[i+1]=res3[i];
 }
 else
 {
 double a=a3/a4,b=a2/a4,c=a1/a4,d=a0/a4;
 /*?????????? ? ??????? ????? ?????????? ???????????*/
 cvector cy0=kardano(1,-b,-4*d+a*c,-d*a*a+4*b*dc*c);
 double y0;
 /*???? ???? ?? ???? ?????????????? ??????, ? 
??????? ???????? ?????? ????????? ????????? ??????? 
? ???????????? ??????????*/
 for(int i=0;i<3;i++)
 if(!imag(cy0[i]))
 {
 y0=real(cy0[i]);
 break;
72
 }
 double A=a*a/4-b+y0,B=a*y0/2-c;
 double x12=-B/(2*A);
 //?????? ?????????? ?????????
 cvector sq1=square(1,a/2-sqrt(A),y0/2+sqrt(A)
*x12);
 cvector sq2=square(1,a/2+sqrt(A),y0/2-sqrt(A)
*x12);
 for(long i=0;i<2;i++)
 res[i]=sq1[i],res[i+2]=sq2[i];
 }
 return res;//?????????? ?????????
}
/*???????????????? ????? ??????? ?????? ??????????? 
?????? ????????*/
cvector newton(cpolynom p)
{
 double t=1,eps=1e-8,j;
 p*=1;/* ????????? ????????? ?? 1 ??? ????, ????? 
????????? ??????? ???? */
 //?????????????? ?????? ????? ????? ???????????,
 //?????? ??????? ????????
 cvector result=p.getm()-1;
 /*???? ??????-????????? ??????????, ?? ????? ???? 
? ????????? ?????? ???????*/
 if(result==cvector())
 {
 result[0]=-p[0]/p[1];
 return result;
 }
 //???? ????????? - ? ?????????? ?????????? ? ?.?.
 if(result.getm()==2)
 return square(p[2],p[1],p[0]);
 if(result.getm()==3&&!imag(p[3])&&!imag(p[2])&&
!imag(p[1])&&!imag(p[0]))
 return kardano(real(p[3]), real(p[2]), real(p[1]), real(p[0]));
 if(result.getm()==4&&!imag(p[4])&&!imag(p[3])&&
!imag(p[2])&&!imag(p[1])&&!imag(p[0]))
73
 return ferrary(real(p[4]), real(p[3]), real(p[2]), real(p[1]), real(p[0]));
 complex z=0;/*????????? ??????????? ? ????? ??????? ?????? (0,0)*/
 do
 {
 complex dz=0;
 /*??????? ??????? ? ???????? ????????? ??????????? ? ????? z */
 for(j=1;dz==complex(0);dz=derive(p,j++)(z));
 z+=t*pow(-p(z)/dz,1/(--j));/*???????????? ???????????*/
 t*=(1-eps);
 }while(abs(p(z))>=eps);
 //????????? ?? ?????????? ???????? ????????
 /*? ???? ????? ????????? ?????? ???? ?????? z. 
??? ?????????? ????????? ????? ???????? ??????? ?? 
?-z, ??????? ??? ????? ??????? ?? ???????, ? ??????? ??? ???? ??????, ? ?.?. ?? ?????? ???????*/
 result[0]=z;
 cpolynom z1=2;
 z1[0]=-z,z1[1]=1;
 cvector more=newton(p/z1);
 for(long i=1;i<result.getm();i++)
 result[i]=more[i-1];
 return result;//?????????? ?????? ??????????
}

